<!DOCTYPE html>
<head>
    <title>Example XT Wallet D-App</title>

    <link rel="stylesheet"
            href="style.css">
    <script type="application/javascript"
            src='https://cdn.jsdelivr.net/npm/@signumjs/wallets@1.0.0-rc.10/dist/signumjs.wallets.js'></script>
    <script type="application/javascript "
            src='https://cdn.jsdelivr.net/npm/@signumjs/core/dist/signumjs.min.js'></script>
    <script type="application/javascript"
            src='https://cdn.jsdelivr.net/npm/@signumjs/util/dist/signumjs.util.js'></script>

    </head>
    <body>
        <div class="header">
            <button id="login">Login</button>
            <button id="logout">Logout</button>
            <button id="donate">Donate</button>
        </div>

        <div id="answerAccount"></div>
        <div id="answerNode"></div>
        <div id="gotoExplorer"></div>
        <div id="balanceUser"></div>

        <script>
            var donationRecipient = "S-DFHC-U26W-H5QH-68Q7C";
            var login = document.getElementById("login");
            var answer = document.getElementById("answer");
            function mountDeeplink() {
                return createDeeplink({
                    payload: {
                        recipient: donationRecipient,
                        amountPlanck: Amount.fromSigna('5.103635').getPlanck(),
                        feePlanck: Amount.fromSigna('0.0735').getPlanck(),
                        message: '59b13cb7d10d5ead3b45b8e9039ebed100000000000000000000000000000000',
                        messageIsText: false,
                        immutable: false,
                        deadline: 1440,
                        encrypt: false
                    },
                    action: 'pay'
                }, )
            }
            
            login.addEventListener("click", function() {
                (async () => {

                    const api = sig$.composeApi({
                        nodeHost: 'https://europe.signum.network'
                    });

                    const wallet = new sig$wallets.GenericExtensionWallet();
                    const {publicKey, connectionStatus, nodeHost, accountId} = await wallet.connect({
                        appName: "Example App",
                        nodeHost: "https://europe.signum.network"   
                    });

                    const newDiv = document.createElement("div");
                    const newContent = document.createTextNode("You connected successfully");
                    newDiv.appendChild(newContent);
                    document.body.insertBefore(newDiv, answerAccount);

                    const accountIdAnswer = document.createTextNode("Your accountId: " + accountId + "\n");
                    const node = document.createTextNode("Your node host: " + nodeHost + "\n");
                    answerAccount.appendChild(accountIdAnswer);
                    answerNode.appendChild(node);

                    const explorer = document.createElement('a');
                    const explorerLink = document.createTextNode("Go to explorer \n");
                    explorer.appendChild(explorerLink);
                    explorer.href = "https://chain.signum.network/address/" + accountId;
                    document.body.appendChild(explorer);

                    api.account.getAccountBalance(accountId).then(balance => {
                        const balUser = sig$util.Amount.fromPlanck(balance.balanceNQT).toString();
                        const balDiv = document.createElement('div');
                        const getBal = document.createTextNode("\nAccount Balance: " + balUser);
                        balDiv.appendChild(getBal);
                        document.body.insertBefore(balDiv, balanceUser);
                    })
                })();
            },false);
            var logout = document.getElementById("logout");
            logout.addEventListener("click", function(){
                alert("Logout not available yet. Please use the XT-Wallet Extension to disconnect your Wallet from the site!");
            }, false);
            var donate = document.getElementById("donate");
            donate.addEventListener("click", function(){
                return mountDeeplink();
            }, false);
        </script>
    </body>
</html>